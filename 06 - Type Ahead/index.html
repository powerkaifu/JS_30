<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Type Ahead ğŸ‘€</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body>
		<form class="search-form">
			<input type="text" class="search" placeholder="City or State" />
			<ul class="suggestions">
				<li>Filter for a city</li>
				<li>or a state</li>
			</ul>
		</form>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js"></script>
		<script>
			// API å‘¼å«
			const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json'
			// function requestHandler() {
			// 	console.log(JSON.parse(this.response))
			// }
			// XMLHttpRequest()
			// let req = new XMLHttpRequest()
			// req.addEventListener('load', requestHandler)
			// req.open('get', endpoint)
			// req.send()

			// fetch()
			// ç¬¬ä¸€ç¨®ä½¿ç”¨è§£æ§‹é™£åˆ—å† push é€² cities
			const cities = []
			fetch(endpoint)
				.then(blob => blob.json())
				.then(data => {
					cities.push(...data) // è§£æ§‹ data é™£åˆ—å¾Œå°‡è³‡æ–™å¡é€² cities
					console.log(cities)
				})

			// ç¬¬äºŒç¨® data ç›´æ¥è³¦äºˆ cities å€¼
			let cities2 = null
			fetch(endpoint)
				.then(blob => blob.json())
				.then(data => {
					cities2 = data
					console.log(cities2)
				})

			const input = document.querySelector('.search')
			const suggestions = document.querySelector('.suggestions')
			// input.addEventListener('change', changeHandler)
			input.addEventListener('keyup', inputHandler)

			/*
        ç´”å‡½å¼è¨­è¨ˆ pure functionï¼Œå·¥å…·å‹å‡½å¼ã€æµè¡Œè¨­è¨ˆå‡½å¼
        vue çš„ computed ä¹Ÿæœ‰ pure function æ¦‚å¿µï¼Œä»¥ get ä¾†èªª
        åªåšå‚³é€²ä¾†ä¸”ä¸æœƒæ”¹è®Š function ä»¥å¤–çš„äº‹æƒ…
        wordToMatch èˆ‡ cities ä¸æœƒè¢«æ”¹è®Šï¼Œåªæ˜¯è¢«å‚³é€²ä¾†åˆ©ç”¨
      */
			function findMatches(wordToMatch, cities) {
				return cities.filter(place => {
					// g å…¨åŸŸï¼Œi ä¸åˆ†å¤§å°å¯«
					const regex = new RegExp(wordToMatch, 'gi')
					return place.city.match(regex) || place.state.match(regex)
				})
			}

			function inputHandler() {
				const matchArray = findMatches(this.value, cities)
				const html = matchArray
					.map(place => {
						const regex = new RegExp(this.value, 'gi')
						const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`)
						const stateName = place.state.replace(regex, `<span>${this.value}</span>`)
						return `
              <li>
                <span class="name">${cityName},${stateName}</span>
                <span class="population">${numberWithCommas(place.population)}</span>
              </li>
            `
					})
					.join('') // é€£æ¥æ‰€æœ‰å­—ä¸²
				suggestions.innerHTML = html
			}

			function numberWithCommas(x) {
				// return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
				return (x * 1).toLocaleString() // toLocaleString() é‡å°æ•¸å­—æ‰æœ‰ä½œç”¨,*1 æœƒè½‰æ•¸å­—
			}
		</script>
	</body>
</html>
